# 规划图多图层功能指南

## 功能概述

规划图编辑器现已支持上传和管理多个规划图层，每个图层可以独立控制位置、透明度和比例尺，方便用户对齐和比较不同的规划图。

## 主要功能

### 1. 多文件上传
- **支持一次选择多个文件**：点击"上传规划底图"区域，可以同时选择多个PNG/JPG文件
- **拖拽上传**：直接拖拽多个图片文件到上传区域

### 2. 独立图层管理
每个上传的规划图都会作为一个独立的图层显示在"规划图层"面板中：

#### 图层属性
- **名称**：显示文件名和图片尺寸
- **显示/隐藏**：点击眼睛图标切换图层的可见性
- **删除**：点击删除图标移除该图层
- **选中状态**：点击图层项可以选中该图层（高亮显示）

#### 透明度控制
- 每个图层都有独立的透明度滑块（0-100%）
- 实时调整透明度，方便查看多个图层之间的关系
- 例如：可以将卫星图设为半透明，叠加在导览图上方

#### 比例尺设置
- 为每个图层单独设置比例尺值（如1:1000）
- 用于更准确地进行区域选择和标注
- 不同来源的图片可能有不同的比例尺

### 3. 图层位置调整
- **拖动图层**：在选择工具或平移工具模式下，可以直接拖动图片调整位置
- **激活状态**：选中的图层会显示蓝色虚线边框
- **对齐不同图层**：通过拖动各个图层，可以将它们精确对齐

### 4. 图层渲染顺序
- 图层按照上传顺序从下往上渲染
- 后上传的图层会显示在上方
- 通过调整透明度可以查看底层图片

## 使用场景示例

### 场景1：公园规划
1. 上传卫星地图作为第一个图层
2. 上传导览图作为第二个图层
3. 调整导览图的透明度为60%
4. 拖动导览图对齐卫星地图上的关键地标
5. 在两个图层上分别标注不同的区域

### 场景2：建筑改造
1. 上传现状平面图
2. 上传设计方案图
3. 调整各图层透明度对比新旧方案
4. 使用不同颜色的图层标注不同功能区

### 场景3：多比例尺规划
1. 上传总平面图（1:2000）
2. 上传局部详图（1:500）
3. 为每个图层设置对应的比例尺
4. 在各自图层上进行精确标注

## 操作技巧

### 快速对齐
1. 选择要对齐的图层（点击图层面板中的图层名）
2. 使用选择工具或平移工具
3. 拖动图片到合适位置
4. 调整透明度查看对齐效果

### 多图层比较
1. 保持所有图层可见
2. 将上层图层的透明度设为50-70%
3. 拖动上层图层精确对齐底层
4. 切换图层显示/隐藏来对比差异

### 精确标注
1. 选择要标注的图层作为参考
2. 设置该图层的比例尺
3. 在该图层上使用矩形、套索或线段工具
4. 标注的区域会自动关联到对应的规划图层

## 界面布局

```
左侧面板：
├── 上传规划底图（支持多文件）
├── 图层管理（区域和线段图层）
└── 规划图层（上传的图片图层）
    ├── 图层1
    │   ├── 透明度滑块
    │   └── 比例尺输入
    ├── 图层2
    └── ...

中央区域：
└── SVG画布
    ├── 图像图层（可拖动）
    ├── 区域标注
    └── 线段标注

右侧面板：
└── 元素属性（选中元素的详细信息）
```

## 注意事项

1. **文件格式**：仅支持PNG和JPG格式的图片
2. **性能**：上传多个大尺寸图片可能影响性能，建议压缩后上传
3. **内存管理**：不使用的图层建议及时删除
4. **保存**：图层配置会随规划数据一起保存

## 快捷键

- **Esc**：取消当前绘制
- **Delete/Backspace**：删除选中元素
- **Enter**：完成当前绘制（套索/线段）
- **滚轮**：缩放画布
- **Ctrl+点击线段**：选择线段而不分割

## 技术实现

- 使用SVG `<image>` 元素渲染图片
- 每个图层独立的transform（位置和缩放）
- 实时透明度调整
- 指针事件支持拖拽和选择
