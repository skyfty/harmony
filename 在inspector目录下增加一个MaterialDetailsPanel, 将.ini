在inspector目录下增加一个MaterialDetailsPanel, 将material-panel__details中的元素和相关代码移动到MaterialDetailsPanel 中, MaterialDetailsPanel是一个浮动面, 当点击material-list中的某一项时显示,并更新MaterialDetailsPanel中的参数为该材质的属性, 点击面板外部区域时隐藏.
MaterialDetailsPanel显示的时候 会浮动显示在InspectorPanel.vue面板的左侧, 位置为距离InspectorPanel左侧边缘10px, 距离顶部边缘10px. 并有一个关闭按钮, 点击关闭按钮时隐藏MaterialDetailsPanel.

需要将MaterialDetailsPanel面板浮动显示在SceneViewport.vue的上层, 而不是在InspectorPanel.vue内部. 以保证不会被SceneViewport.vue遮挡.

为MaterialDetailsPanel.vue增加一个和InspectorPanel.vue一样的v-toolbar, 以保证风格一致.并将关闭按钮放在v-toolbar的右侧.

将MaterialDetailsPanel.vue面板的样式整理成和InspectorPanel.vue一样的风格, 包括圆角, 阴影, 边框, 标题栏等. 同时将关闭按钮放置在标题栏的右侧的toggle-placement按钮位置.

修改成将 将MaterialDetailsPanel.vue浮动 位置为距离InspectorPanel左侧边缘20px, 距离顶部边缘20px

点击面板外部区域时不要隐藏. 只有关闭按钮,或是材质列表中没有选中项时才隐藏MaterialDetailsPanel.vue面板.

删除按钮,handleAddMaterialSlot按钮, 放置在v-expansion-panel的标题栏上在收起按钮左侧旁边. 

MaterialDetailsPanel.vue面板中的


const materialClasses = {
	'MeshBasicMaterial': THREE.MeshBasicMaterial,
	'MeshNormalMaterial': THREE.MeshNormalMaterial,
	'MeshLambertMaterial': THREE.MeshLambertMaterial,
	'MeshMatcapMaterial': THREE.MeshMatcapMaterial,
	'MeshPhongMaterial': THREE.MeshPhongMaterial,
	'MeshToonMaterial': THREE.MeshToonMaterial,
	'MeshStandardMaterial': THREE.MeshStandardMaterial,
	'MeshPhysicalMaterial': THREE.MeshPhysicalMaterial,
};

MaterialDetailsPanel.vue中增加一个材质类型的下拉选择框, 位置在名称输入框的下方. 下拉选择框的选项为materialClasses中的材质类型. 当选择不同的材质类型时, 会将当前材质更改为所选择的材质类型, 并保留原有材质的属性值(如果新材质类型有对应的属性的话). 例如, 如果当前材质是MeshBasicMaterial, 更改为MeshPhongMaterial时, 会保留颜色, 透明度等属性值.
当材质类型更改后, MaterialDetailsPanel.vue面板中的属性输入框会根据新材质类型进行更新, 显示该材质类型所支持的属性输入框. 同时将此材质应用到场景中所有使用该材质的对象上.

不在使用mesh-standard类型. 有多处normalizeSceneMaterialType函数定义,和MATERIAL_CLASS_NAMES变量一起整理到material.ts中.将materialClasses中的材质类型名称改为和MATERIAL_CLASS_NAMES中一致. 避免重复定义和命名不一致的问题.

MaterialDetailsPanel.vue选择


在AssetCategoryDefinition中增加一个Material和 Texture的key, 和AssetCategoryDefinition中的相关配置, 用于在ProjectPanel.vue显示材质资源类别. 使得材质资源可以在ProjectPanel.vue中进行浏览和选择.

在修改一个基本网格模型的Default Material参数后后, 再次新建一个基本网格模型时, 应用的材质应该是初始的默认材质. 而不是上次修改后的材质. 需要在创建基本网格模型时, 强制使用初始的默认材质. 并做为此节点的独立材质, 避免后续修改默认材质时影响到已创建的基本网格模型节点. 只有将材质保存为ProjectPanel.vue中的共享材质后,才会修改为引用共享材质。
在MaterialDetailsPanel.vue面板中增加一个Save按钮, 点击该按钮时将当前材质保存到ProjectPanel.vue中的材质资源类别中, 并生成一个新的材质资源项. 该材质资源项做为共享材质,可以在ProjectPanel.vue中进行浏览和选择,删除, 并能将其拖放到MaterialPanel.vue中的材质列表中为场景对象分配该材质.如果拖放到的位置已有材质槽, 则替换该材质槽的材质为所拖放的共享材质.如果拖放到空白位置, 则新增一个材质槽并分配所拖放的共享材质.在删除共享材质时, 需要检查场景中所有使用该材质的对象, 并将其材质更改为默认材质, 避免出现丢失材质的情况.同时提示用户确认删除操作.

修改一下texture-tile的样式,修改为左侧显示一个小的缩略图占用两行, 右侧在右上角显示mdi-close图标, 中间第一行显示resolveTextureName(slot), 第二行显示TEXTURE_LABELS[slot]. 


当删除MaterialPanel.vue面板中的某个材质槽时, 如果该材质槽所使用的材质是从ProjectPanel.vue中的共享材质类别中选择的共享材质, 则不删除该共享材质资源项, 只删除材质槽和对该材质的引用. 只有在ProjectPanel.vue中删除该共享材质资源项时, 才会删除该共享材质. 删除材质槽时, 需要检查场景中所有使用该材质的对象, 并将其材质更改为默认材质, 避免出现丢失材质的情况.同时提示用户确认删除操作. 如果删除的是场景对象的独立材质, 则直接删除该材质槽和材质即可. 如果是删除了最后一个材质槽, 则将场景对象的材质更改为默认材质.