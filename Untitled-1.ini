/home/sky/harmony/editor/src/components/editor/ViewportToolbar.vue中的墙壁建造工具改成按下鼠标中键开始建造

在建造按钮激活时中，鼠标左键依然可以用来平移视图，鼠标右键依然可以用来旋转视图。 在已经开始建造墙壁后，鼠标右键取消建造，鼠标左键依然可以用来平移视图

新建场景后不要选择任何场景节点，现在是默认选择地面节点

为/home/sky/harmony/editor/src/components/inspector/WallPanel.vue添加两个资产模型组件， 分别是保存墙壁资产模型和加载墙壁资产模型， 可以参考/home/sky/harmony/editor/src/components/inspector/AssetModelPanel.vue中的实现。 一个模型组件用于当前墙壁主体渲染网格模型， 另一个模型组件用于当前墙壁连接处渲染网格模型。 当设置了墙壁资产模型后， 新建墙壁时会使用该资产模型进行渲染。设置了连接处资产模型后， 墙壁连接处会使用该资产模型进行渲染。墙壁模型的渲染使用InstancedMesh实现， 连接处模型的渲染也使用InstancedMesh实现。没有设置资产模型时， 使用默认的WallDynamicMesh墙壁和连接处模型进行渲染。当使用InstancedMesh渲染墙壁和连接处时要考虑到墙壁的走势变化， 例如墙壁的转折等。 墙壁连接处的模型要根据墙壁的转折角度进行旋转对齐，墙壁主体的模型要根据墙壁的走势进行相应的旋转， 但是不需要使用宽度和高度参数，这两个参数是给WallDynamicMesh使用的。

/home/sky/harmony/editor/src/stores/sceneStore.ts中的updateNodeComponentProps等函数对Wall类型的组件处理不对， 没有处理新加入的墙壁组件属性bodyAssetId和jointAssetId， 需要补充完整。 

需要将渲染墙壁的代码放到/home/sky/harmony/schema/wallMesh.ts中，用于在/home/sky/harmony/editor/src/views/ScenePreviewView.vue和/home/sky/harmony/miniprogram/src/pages/scene-viewer/index.vue中渲染墙壁时使用， 因为这两个文件是分别用于编辑器预览场景和小程序查看场景的， 需要共享渲染墙壁的代码逻辑， 能使用bodyAssetId和jointAssetId以及WallDynamicMesh来渲染墙壁和连接处模型。主要的修改为/home/sky/harmony/schema/sceneGraph.ts文件中的buildWallMesh函数

/home/sky/harmony/editor/src/components/editor/SceneViewport.vue中在渲染墙体时，如果墙节点已经设置了bodyAssetId或jointAssetId， 则使用资产模型进行渲染， 否则使用默认的WallDynamicMesh进行渲染

在/home/sky/harmony/editor/src/components/editor/SceneViewport.vue中的createObjectFromNode函数中， 墙壁节点创建时要考虑bodyAssetId和jointAssetId属性， 如果有设置则使用资产模型进行渲染， 否则使用默认的WallDynamicMesh进行渲染

墙节点的WallDynamicMesh和资产模型只能二选一， 如果设置了资产模型则不使用WallDynamicMesh， 如果没有设置资产模型则使用WallDynamicMesh， 不能同时创建并渲染WallDynamicMesh和资产模型

将/home/sky/harmony/editor/src/components/editor/SceneViewport.vue文件中和墙体渲染相关的代码， 尽量独立封装到/home/sky/harmony/editor/src/components/editor/WallRenderer.ts文件中， 以便于维护和管理墙体渲染的代码逻辑

将WallPreview相关的渲染代码尽量独立封装到/home/sky/harmony/editor/src/components/editor/WallPreviewRenderer.ts文件中， 以便于维护和管理墙体预览渲染的代码逻辑


/home/sky/harmony/editor/src/components/editor/SceneViewport.vue中如果墙体是使用资产模型渲染的， 则在拖动墙体节点时，或是通过操作轴对墙体做旋转、平移等操作时也需要能使用资产模型进行渲染， 现在在选中墙体模型后，第一次拖动墙体节点或是通过操作轴对墙体做旋转、平移等操作时， 墙体并没有跟随鼠标或操作轴进行移动或旋转， 当放开鼠标后墙体才会跳到新的位置，同时会在墙体周边生成一个包围框， 需要修改为在拖动或旋转墙体时墙体能够实时跟随鼠标或操作轴进行移动或旋转，同时不要在拖动完毕后生成包围框 这样用户体验会更好一些， 中文回复我这是什么原因导致的， 并修复这些问题

/home/sky/harmony/editor/src/components/editor/SceneViewport.vue改变墙体位置或是缩放旋转，或是拖动墙体节点时， 需要确保墙体的资产模型能够正确跟随墙体的位置、缩放、旋转进行变化， 现在墙体的资产模型并没有正确跟随墙体进行变化， 处理墙体的位置、缩放、旋转变化时应该和普通的网格模型处理方式一样的逻辑， 需要修复墙体资产模型不能正确跟随墙体位置、缩放、旋转变化的问题。 现在在拖动墙体模型后会将PickProxy的instancedPickProxyGeometry显示出来， 需要修改为拖动墙体模型不显示PickProxy的instancedPickProxyGeometry，尝试修复这些问题

syncWallContainer函数中对墙体资产模型的处理不对， 不要对墙体资产模型做缩放，如果墙体长度比模型长度长， 则通过增加墙体模型的实例数量来渲染更长的墙体， 不要通过缩放墙体资产模型来实现更长的墙体渲染，增加墙体InstancedMesh实例时，需要考虑到墙体的宽度，使墙体的InstancedMesh能无缝的连在一起，不要用间隔和重叠， 需要修复这个问题


墙体的如果使用资产模型渲染的时候， 其创建和渲染逻辑需要使用/home/sky/harmony/schema/continuousInstancedModel.ts中的代码逻辑， 以便于和其他使用资产模型渲染的组件保持一致， 需要修改墙体资产模型的创建和渲染逻辑。 墙体的渲染和创建只是普通的连续实例化模型渲染和创建， 只不过墙体是根据墙体的走势来摆放连续实例化模型， 其他的逻辑和连续实例化模型是一样的。将现有的代码全部删除， 重新实现墙体资产模型的创建和渲染逻辑， 以便于和其他使用资产模型渲染的组件保持一致

/home/sky/harmony/editor/src/components/editor/SceneViewport.vue文件ensureInstancedPickProxy函数对于PickProxy的ConvexGeometry创建不对， 需要修改为使用的实际几何形状来创建ConvexGeometry， 现在是使用包围盒来创建ConvexGeometry， 这样会导致PickProxy的碰撞检测不准确，不需要非常精确的形状， 只要大概能包围场景节点实际网格模型的的包围区域即可，例如一个单体模型只需要一个长方体， 两个并排的模型时只需要一个更长的长方体，但是如果多个InstancedMesh实例没有在一条直线上时， 就需要生成对应的ConvexGeometry， 需要修复这个问题

将/home/sky/harmony/editor/src/components/editor/SceneViewport.vue文件中和PickProxy相关的代码， 尽量独立封装到/home/sky/harmony/editor/src/components/editor/PickProxyManager.ts文件中， 以便于维护和管理PickProxy相关的代码逻辑

将/home/sky/harmony/editor/src/components/editor/SceneViewport.vue文件中和InstancedOutline相关的代码， 尽量独立封装到/home/sky/harmony/editor/src/components/editor/InstancedOutlineManager.ts文件中

/home/sky/harmony/editor/src/components/editor/PickProxyManager.ts文件中ensureInstancedPickProxy函数对于由多个不在同一直线上的InstancedMesh实例创建PickProxy的ConvexGeometry时， 需要根据实际的InstancedMesh实例位置来创建对应的ConvexGeometry，然后将多个InstancedMesh实例对应的ConvexGeometry合并成一个不规则的包围多边体， 现在是使用包围盒来创建ConvexGeometry， 这样会导致PickProxy的碰撞检测不准确，例如一个有多个墙体组成的有角度的大墙体时，会在交合处有一个直角，此时，包围盒子应该成了L行，而不是一个正方体，否则在点击两个墙体之间的角落部分时， 也会选中这个墙体， 这是不正确的， 需要修复这个问题

在/home/sky/harmony/editor/src/components/editor/ViewportToolbar.vue中墙壁建造工具按钮旁边增加一个道路建造按钮， 点击该按钮后切换到道路建造工具模式， 道路建造工具模式下按下鼠标中键开始建造道路， 松开鼠标中键结束道路建造。 在道路建造工具模式下， 鼠标左键依然可以用来平移视图，鼠标右键依然可以用来旋转视图。道路建造模式下可以仿照墙壁建造的逻辑来实现， 主要区别是道路是一个平面， 不像墙壁是由一系列直线段组成的。 道路建造流程如下：开始建造时，鼠标中键点击后保存一个道路顶点， 移动鼠标时自动从上一个顶点创建一个矩形平面到鼠标所在位置的地面投影， 再次点击鼠标中键后保存此顶点，并同上一个顶点连接成一段道路， 此时可以再次移动鼠标到下一个顶点，并依次连接成道路， 鼠标右键点击后结束创建并创建道路节点， 从每个顶点位置可以延伸出新的道路分叉。 道路节点有一个组件类型为Road， 该组件有一个属性points， 用于存储道路的顶点列表， 顶点列表是一个二维数组， 每个顶点包含x和y坐标值， 表示道路在地面的投影位置，高度值统一为0， 有一个宽度属性，用途于设置道路的默认宽度，默认为2米。 道路节点还可以有其他属性， 例如材质等。 道路建造工具需要处理道路的顶点捕捉功能， 可以参考墙壁建造工具的实现逻辑。将道路网格的定义和的渲染代码要独立出来存放在/home/sky/harmony/schema目录下， 以便/home/sky/harmony/miniprogram/src/pages/scene-viewer/index.vue和/home/sky/harmony/editor/src/views/ScenePreviewView.vue中使用， 主要参考墙壁网格的实现逻辑。道路也要支持资产模型和DynamicMesh渲染， 参考墙壁资产模型的实现逻辑。

DynamicMeshType中去掉Platform、Surface类型和所有相关代码

新建的道路和地面重合了, 导致道路的多边形渲染有问题， 出现了z-fighting现象， 需要将道路网格的高度提升一些， 例如提升0.01米， 以避免和地面网格重合导致的z-fighting问题,或是修改路面和道路的order值， 使道路的渲染优先级高于地面渲染优先级， 以避免z-fighting问题

/home/sky/harmony/editor/src/components/editor/SceneViewport.vue中的createObjectFromNode函数中， 道路节点创建时要创建道路网格模型， 参考墙壁节点的实现逻辑


在新建的道路过程中道路的预览网格也和地面重合了， 出现了z-fighting现象， 需要将道道路的预览网格的高度提升一些， 例如提升0.01米， 以避免和地面网格重合导致的z-fighting问题,或是修改路面和道路的order值， 使道路的渲染优先级高于地面渲染优先级， 以避免z-fighting问题

依然看不清， 是不是颜色和透明度的问题？检查并修复

当选择道路场景节点后， 并且激活了道路建造工具时， 会在道路的每个连接顶点位置显示一个圆面，直径和道路宽度一致， 用于表示道路的连接顶点位置， 这样用户可以更清晰的看到道路的连接顶点位置， 当在这个圆面上点击鼠标中键后，可以用这个连接顶点做为道路起点建造新的道路分支，形成分叉路。或是通过拖动/移动圆面网格来调整和此圆面相连的道路的路径走向位置， 圆面网格使用一种醒目的颜色进行渲染， 以便于区分道路网格。 当取消选择道路节点或是切换到其他工具时， 隐藏这些圆面网格。

在通过道路交叉顶点拖动/移动来调整道路路径走向位置后，道路顶点的圆面网格不显示了， 需要修复这个问题。 同时在创建完道路后， 这些圆面网格也没有显示， 需要修复这个问题

通过鼠标移动道路的建设和道路顶点的调整时，不需要对齐地面网格线交叉点， 要可以自由移动 
在通过道路交叉顶点拖动/移动来调整道路路径走向位置后，道路顶点的圆面网格依然不显示， 需要修复这个问题

将RoadVertex相关的渲染代码尽量独立封装到/home/sky/harmony/editor/src/components/editor/RoadVertexRenderer.ts文件中， 以便于维护和管理RoadVertex相关的代码逻辑

在/home/sky/harmony/schema/sceneGraph.ts中增加对多道路数据的渲染的支持，以便/home/sky/harmony/editor/src/views/ScenePreviewView.vue和/home/sky/harmony/miniprogram/src/pages/scene-viewer/index.vue中渲染道路时使用

建造道路预览的时的颜色设置不生效， 无论设置成什么 颜色都是黑色。 需要分析一下原因， 并修复这个问题

当建造道路时，如果两个道路的连接顶点重合时， 将两个道路连接顶点合并成一个道路顶点， 并且合并后的道路的顶点去重， 以避免重复顶点。 并将两段道路连接在一起， 需要实现这个功能

当建造道路时当前建造的道路顶点如果可以吸附到已有道路的连接顶点时， 将当前建造的道路顶点吸附到已有道路的连接顶点位置， 以便于实现道路的连接和分叉， 需要实现这个功能

将/home/sky/harmony/editor/src/components/editor/SceneViewport.vue和Road相关的代码逻辑独立成一个模块文件放到/home/sky/harmony/editor/src/components/editor目录下

在建造道路的过程中如果点击的位置已经有了道路顶点时则复用已有的道路顶点， 不要重复创建新的道路顶点， 以避免重复顶点， 需要实现这个功能。目前只在开始建造时做了顶点复用， 后续建造过程中没有做顶点复用， 需要补充完整

目前多条道路连接在一起时， 连接处会有缝隙， 需要修复这个问题， 道路连接处要无缝连接在一起

在/home/sky/harmony/editor/src/components/inspector/RoadPanel.vue为道路增加一个宽度属性， 用于设置道路的网格宽度， 默认值为2米， 当用户调整道路宽度属性时， 道路网格宽度也要相应调整， 需要实现这个功能

去掉/home/sky/harmony/editor/src/components/inspector/RoadPanel.vue中的Segment Material属性设置和所有相关代码， 不用单独为每段道路设置材质， 道路节点只用一个材质属性， 用于设置整条道路的材质。 不同段道路使用同一个材质进行渲染。 对于多种不同材质的道路， 可以通过复制道路节点来实现， 每个道路节点可以设置不同的材质属性， 修复这个问题。 但是对于多条不同材质的道路的连接的地方会很不自然，如何解决这个问题？给我中文回复。

/home/sky/harmony/editor/src/components/layout/PlanningDialog.vue中的图层需要能添加删除功能：
1. 在Layer Management右侧增加一个增加按钮，弹出增加图册菜单，菜单中出，LayerKind中的可增加的图层项
2. 点击菜单项后增加图层，图层名称默认为图层类型名称+数字编号，编号从1开始递增
3. 图层项右侧增加删除按钮，点击后删除图层
4. 图层项可以拖动排序，排序后图层的渲染顺序也要相应调整
5. 图层项可以双击重命名图层名称

/home/sky/harmony/editor/src/components/layout/PlanningDialog.vue中的图形属性区域需要依据不同类型的图层显示对应的属性面板：
1. green层保持当前图形属性面板不变
2. terrain层暂时为空，以后再设计
3. building层暂时为空，以后再设计
4. road层，显示道路图层属性面板， 包含道路宽度属性设置
5. wall层，层暂时为空，以后再设计

道路层道路宽度参数发生改变时需要同步更新图层中道路线条图形的宽度

不对，绘制的线条宽度没有变化， 需要修复这个问题。 但是绘制的预览线条宽度是正确的， 说明属性面板和预览线条是联动的， 但是没有联动到最终绘制的线条， 需要修复这个问题

宽度默认设置为2米， 用户可以调整宽度参数， 范围为0.1米到10米， 步长为0.1米

在道路层时，只有在线段工具激活时才能编辑修改线段，在选择工具激活时不能编辑修改线段， 只能选中和修改参数， 避免在选择工具激活时误操作修改线段， 需要实现这个功能

在鼠标点击图形中操作顶点时需要为此顶点加个荧光高亮效果， 以便于区分当前操作的顶点， 矩形工具、多边形工具、道路层的线段工具都需要实现这个功能，

按下顶点时的效果可以， 还要增加一个选中顶点的效果， 选中顶点时顶点也要有高亮效果， 需要补充完整

使用线段工具绘制线段时，当前选中的顶点不对， 在绘制时， 应该是最后一个顶点被选中， 但是现在是第一个顶点被选中， 需要修复这个问题

在线段工具中绘制线段时， 如果按下鼠标左键并拖动鼠标时， 为拖动顶点行为，保持当前逻辑不变。 当选中一个顶点后， 在其他区域中点击鼠标左键时， 此时在鼠标位置添加一个新顶点， 同时将两个顶点用新的线段连接起来， 形成线段分支的效果， 并将新顶点设为选中状态， 需要修改数据结构用于支持一个线段顶点可以有多条线段的功能。

顶点的选中范围有些大了， 在顶点的周边点击时也会选中顶点， 需要适当减小顶点的选中范围， 以避免误操作选中顶点

在绘制线段时， 鼠标没有悬停在线段上时， 在线段的周边也能为线段增加顶点， 这是不正确的， 需要鼠标在可见的线段上点击时才能为线段增加顶点， 需要修复这个问题

线段顶点需要在绘制时也要显示，以便可以清晰看到线段的顶点位置。 
在绘制线段时， 如果鼠标点击的位置已经有一个顶点时， 则复用已有的顶点， 不要重复创建新的顶点， 以避免重复顶点， 需要实现这个功能，同时将两个线段连接在一起， 形成线段分支的效果

在点击转换为3d场景时需要将规划场景数据中的道路图层数据转换为场景节点数据， 以便在3d场景中渲染道路网格模型， 需要实现这个功能


在点击转换为3d场景时需要将规划场景数据中的道路图层数据转换为场景节点数据， 以便在3d场景中渲染道路网格模型， 需要实现这个功能

/home/sky/harmony/editor/src/components/layout/PlanningDialog.vue中的图形属性区域需要依据不同类型的图层显示对应的属性面板：wall层提供墙壁图层属性面板， 包含墙壁高度和墙壁厚度属性设置


在点击转换为3d场景时需要将规划场景数据中的墙壁图层数据转换为场景节点数据， 以便在3d场景中渲染墙壁网格模型， 需要实现这个功能

转换后的创建的场景节点需要设置为锁定状态， 以避免误操作修改墙壁节点， 需要实现这个功能

/home/sky/harmony/editor/src/components/layout/PlanningDialog.vue中如果画布太大的话， 默认没有将画布全部显示出来， 同时缩放的限制太小了， 通过滚轮缩放也不能将画布全部呈现出来， 需要修复这个问题

在工具栏的右增加一个重置视图按钮， 点击后将规划画布的视图重置为默认位置， 以便于查看整个规划画布内容， 需要实现这个功能， 同时一个滑块用于控制规划画布的缩放比例， 范围为10%到400%， 默认值为100%，并能和鼠标滚轮联动， 需要实现这个功能

范围为10%到400%， 默认值为100%。 滑块小一些， 现在太大了， 占用了太多空间， 需要调整这个问题

在道路层或是墙壁层激活时禁止使用矩形或是多变形工具

不要使用禁用和启用的方式， 使用显示和隐藏的方式来限制按钮的可用性


在/home/sky/harmony/editor/src/components/editor/ViewportToolbar.vue中墙壁建造工具按钮旁边增加一个地面建造按钮， 点击该按钮后切换到道路建造工具模式， 道路建造工具模式下按下鼠标中键开始建造道路， 松开鼠标中键结束道路建造。 在道路建造工具模式下， 鼠标左键依然可以用来平移视图，鼠标右键依然可以用来旋转视图。道路建造模式下可以仿照墙壁建造的逻辑来实现， 主要区别是道路是一个平面， 不像墙壁是由一系列直线段组成的。 道路建造流程如下：开始建造时，鼠标中键点击后保存一个道路顶点， 移动鼠标时自动从上一个顶点创建一个矩形平面到鼠标所在位置的地面投影， 再次点击鼠标中键后保存此顶点，并同上一个顶点连接成一段道路， 此时可以再次移动鼠标到下一个顶点，并依次连接成道路， 鼠标右键点击后结束创建并创建道路节点， 从每个顶点位置可以延伸出新的道路分叉。 道路节点有一个组件类型为Road， 该组件有一个属性points， 用于存储道路的顶点列表， 顶点列表是一个二维数组， 每个顶点包含x和y坐标值， 表示道路在地面的投影位置，高度值统一为0， 有一个宽度属性，用途于设置道路的默认宽度，默认为2米。 道路节点还可以有其他属性， 例如材质等。 道路建造工具需要处理道路的顶点捕捉功能， 可以参考墙壁建造工具的实现逻辑。将道路网格的定义和的渲染代码要独立出来存放在/home/sky/harmony/schema目录下， 以便/home/sky/harmony/miniprogram/src/pages/scene-viewer/index.vue和/home/sky/harmony/editor/src/views/ScenePreviewView.vue中使用， 主要参考墙壁网格的实现逻辑。道路也要支持资产模型和DynamicMesh渲染， 参考墙壁资产模型的实现逻辑。

道路和墙壁层在建造线段图形时， 如果工具为select时， 禁止建造线段图形， 只能在工具为line时才能建造线段图形， 以避免误操作建造线段图形， 工具为select是需要可以选中图形和平移图形

没有实现这个功能， 需要补充完整。 在select工具激活后， 需要可以选中和平移当前图层中的图形， 和平移矩形和多边形图形行为一样

当切换图层后当前选中的图形顶点的高亮效果没有取消， 需要修复这个问题


线段的绘制需要重新实现一下， 不需要绘制预览了， 每次点击鼠标左键时直接添加顶点并连接线段， 鼠标移动时只需要预览最后一段线段即可， 以简化线段绘制的逻辑， 需要修改这个问题